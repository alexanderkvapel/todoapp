(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();class f{_events;constructor(){this._events=new Map}on(t,e){this._events.has(t)||this._events.set(t,new Set),this._events.get(t)?.add(e)}off(t,e){this._events.has(t)&&(this._events.get(t).delete(e),this._events.get(t)?.size===0&&this._events.delete(t))}emit(t,e){this._events.forEach((i,n)=>{n==="*"&&i.forEach(o=>o({eventName:t,data:e})),(n instanceof RegExp&&n.test(t)||n===t)&&i.forEach(o=>o(e))})}onAll(t){this.on("*",t)}offAll(){this._events=new Map}trigger(t,e){return(i={})=>{this.emit(t,{...i||{},...e||{}})}}}class p{constructor(t){this.events=t}items=[];setItems(t){this.items=t,this.events.emit("items:changed")}addItem(t){this.items.unshift(t),this.events.emit("items:changed")}deleteItem(t){this.items=this.items.filter(e=>e.id!==t),this.events.emit("items:changed")}getItem(t){const e=this.items.find(i=>i.id===t);if(!e)throw new Error(`Дело с id=${t} не найдено`);return e}getItems(){return this.items}checkItem(t){const e=this.getItem(t);e&&(e.completed=!e.completed),this.events.emit("items:changed")}getItemsCount(){return this.items.length}getNotCompletedItemsCount(){return this.items.filter(t=>!t.completed).length}isCompleted(t){const e=this.items.find(i=>i.id===t);if(e)return e.completed;throw new Error(`Не найдено дело с id=${t}`)}}class g{baseUrl;options;constructor(t,e={}){this.baseUrl=t,this.options={headers:{"Content-Type":"application/json",...e.headers??{}}}}handleResponse(t){return t.ok?t.json():t.json().then(e=>Promise.reject(e.error??t.statusText))}get(t){return fetch(this.baseUrl+t,{...this.options,method:"GET"}).then(this.handleResponse)}post(t,e,i="POST"){return fetch(this.baseUrl+t,{...this.options,method:i,body:JSON.stringify(e)}).then(this.handleResponse)}}const h="/todos";class E{api;constructor(t){this.api=t}getTasks(){return this.api.get(h)}addTask(t){return this.api.post(h,t)}deleteTask(t){return this.api.post(h,t,"DELETE")}editTask(t){return this.api.post(h,t,"PATCH")}}function u(s){return typeof s=="string"&&s.length>1}function y(s,t=document){if(u(s))return Array.from(t.querySelectorAll(s));if(s instanceof NodeList)return Array.from(s);if(Array.isArray(s))return s;throw new Error("Unknown selector element")}function r(s,t){if(u(s)){const e=y(s,t);if(e.length>1&&console.warn(`selector ${s} return more then one element`),e.length===0)throw new Error(`selector ${s} return nothing`);return e.pop()}if(s instanceof HTMLElement)return s;throw new Error("Unknown selector element")}function _(s){const t=r(s);if(t.content.firstElementChild)return t.content.firstElementChild.cloneNode(!0);throw new Error("Template has no content")}class a{constructor(t){this.container=t}toggleClass(t,e,i){t.classList.toggle(e,i)}setText(t,e){t&&(t.textContent=String(e))}setDisabled(t,e){t&&(e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"))}setHidden(t){t.style.display="none"}setVisible(t){t.style.removeProperty("display")}setImage(t,e,i){t&&(t.src=e,i&&(t.alt=i))}render(t){return Object.assign(this,t??{}),this.container}}class v extends a{toDosElement;tasksCounterElement;completedTasksCounterElement;constructor(t){super(t),this.toDosElement=r(".todos__list",this.container),this.tasksCounterElement=r(".todos__total",this.container),this.completedTasksCounterElement=r(".todos__remaining",this.container)}set toDoList(t){this.toDosElement.replaceChildren(...t)}set tasksTotal(t){this.setText(this.tasksCounterElement,t)}set tasksRemain(t){this.setText(this.completedTasksCounterElement,t)}}class T extends a{constructor(t,e){super(t),this.events=e,this.titleElement=r(".todo-item__text",this.container),this.deleteButtonElement=r(".todo-item__del",this.container),this.copyButtonElement=r(".todo-item__copy",this.container),this.checkBoxElement=r(".todo-item__flag-off",this.container),this.deleteButtonElement.addEventListener("click",()=>this.events.emit("item:delete",{id:this.identificator})),this.copyButtonElement.addEventListener("click",()=>this.events.emit("item:copy",{id:this.identificator})),this.checkBoxElement.addEventListener("click",()=>this.events.emit("item:check",{id:this.identificator}))}identificator=0;titleElement;deleteButtonElement;copyButtonElement;checkBoxElement;set title(t){this.setText(this.titleElement,t)}set completed(t){this.toggleClass(this.checkBoxElement,"todo-item__flag-on",t),this.toggleClass(this.checkBoxElement,"todo-item__flag-off",!t)}set id(t){this.identificator=t}}class k extends a{constructor(t,e){super(t),this.events=e,this.inputFieldElement=r(".todos__input",this.container),this.submitButtonElement=r(".todos__submit-btn",this.container),this.errorMessageElement=r(".todos__error-message"),this.container.addEventListener("submit",i=>{i.preventDefault(),this.inputFieldElement.value.length===0?this.displayError=!0:(this.events.emit("form:submit",{value:this.inputFieldElement.value}),this.displayError=!1),this.value=""})}inputFieldElement;submitButtonElement;errorMessageElement;set value(t){this.inputFieldElement.value=t.trim()}set buttonText(t){this.setText(this.submitButtonElement,t.trim())}set displayError(t){this.toggleClass(this.errorMessageElement,"visually-hidden",!t)}}const w=new g("https://jsonplaceholder.typicode.com/"),c=new f,m=new E(w),l=new p(c),C=new v(document.querySelector(".page__content"));new k(document.querySelector(".todos__form"),c);const b=document.querySelector("#todo-item-template");m.getTasks().then(s=>{l.setItems(s)}).catch(s=>console.error("Ошибка при загрузке дел с сервера:",s));c.on("items:changed",()=>{const s=l.getItems().map(t=>new T(_(b),c).render(t));C.render({toDoList:s,tasksTotal:l.getItemsCount(),tasksRemain:l.getNotCompletedItemsCount()})});c.on("item:delete",({id:s})=>{l.deleteItem(s)});c.on("item:copy",({id:s})=>{const{title:t}=l.getItem(s);m.addTask({title:t,completed:!1}).then(e=>l.addItem(e)).catch(e=>console.error("Ошибка при добавлении нового дела на сервер:",e))});c.on("item:check",({id:s})=>{l.checkItem(s)});c.on("form:submit",({value:s})=>{m.addTask({title:s,completed:!1}).then(t=>l.addItem(t)).catch(t=>console.error("Ошибка при добавлении нового дела на сервер:",t))});
